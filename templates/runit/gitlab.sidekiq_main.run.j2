#!/bin/bash
#
# Generated by Ansible
# Local modifications will be overwritten.
#

# Settings
APP_ROOT={{ gitlab.application.base_path }}
APP_USER={{ gitlab.git_user.name }}
APP_GROUP={{ gitlab.gitlab_user.name }}
APP_RAILS_ENV='{{ gitlab.application.env }}'

CMD="bundle exec sidekiq -c 5 -q post_receive,build_result,project_web_hook,system_hook,common,default -e ${APP_RAILS_ENV}"

# Set ENV
export PATH=/usr/local/rbenv/bin:$PATH
export RAILS_ENV=$APP_RAILS_ENV

cd $APP_ROOT/current

# Run
exec 2>&1
echo "Running sidekiq main..."
exec chpst -u "${APP_USER}:${APP_GROUP}" $CMD
