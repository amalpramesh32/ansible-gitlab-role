#!/bin/bash
#
# Generated by Ansible
# Local modification will be overwritten.
#

# Settings
APP_ROOT={{ gitlab.application.base_path }}
APP_USER={{ gitlab.git_user.name }}
APP_GROUP={{ gitlab.gitlab_user.name }}
APP_RAILS_ENV='{{ gitlab.application.env }}'

PUMA_CONFIG="$APP_ROOT/current/config/puma.rb"
CMD="bundle exec puma -C $PUMA_CONFIG"
CHPSTKEY="-u ${APP_USER}:${APP_GROUP}"


# Set environment variables
export RAILS_ENV=$APP_RAILS_ENV
export PUMA_PORT={{ gitlab.application.web_port }}
export PUMA_WORKERS=3
export PUMA_BACKLOG=1000
export PATH=/usr/local/rbenv/bin:$PATH

cd ${APP_ROOT}/current

# Run
exec 2>&1
echo "Running gitlab web server..."
exec chpst $CHPSTKEY $CMD
